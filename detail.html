<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品详情</title>
    <link rel="stylesheet" href="./css/home.css">
    <link rel="stylesheet" href="./css/detail.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
</head>
<body>
    <div class="app">
        <div class="header">
            <div class="header-tpbar">
                <div class="container">
                    <div class="tpbar-nav">
                        <a href="index.html">小米商城</a>
                        <span class="sep">|</span>
                        <a href="list.html">小米列表</a>
                        <span class="sep">|</span>
                        <a href="cart.html">小米购物车</a>
                        <span class="sep">|</span>
                        <a href="buy.html">小米支付</a>
                        <span class="sep">|</span>
                        <a href="detail.html">小米详情</a>
                        <span class="sep">|</span>
                        <a href="#" class="tpbar-download">下载APP
                            <span class="appcode">
                                <img src="./pic/download.png" alt="小米商城" width="90px" height="90px">
                                小米商城APP
                            </span>
                        </a>
                        <span class="sep">|</span>
                        <a href="#">ARE YOU OK</a>
                        <span class="sep">|</span>
                    </div>
                    <div class="tpbar-cart">
                        <a href="cart.html" class="cart-mini">
                            <em class="iconfont-cart"></em>
                            <em class="iconfont-cart-full hide"></em>
                            购物车
                        </a>
                        <div class="cart-menu">
                            <div class="msg">
                                购物车中还没有商品，赶紧选购吧！
                            </div>
                        </div>
                    </div>
                    <div class="tpbar-info">
                        <a class="link" href="login.html">登录</a>
                        <span class="sep">|</span>
                        <a class="link" href="register.html">注册</a>
                    </div>
                    <div class="tpbar-self">
                        <span class="sep">|</span>
                        <dpan href="javascript:;" class="link" id="infoSelf"></dpan>
                        <span href="javascript:;" class="btn btn-primary btn-xs" id="logout">退出</span>
                        <span class="sep">|</span>
                    </div>
                </div>
            </div>
        </div>
        <center><h3>产品详情页面</h3></center>
        <div class="mi-product clearfix">
            <div class="container">
                <div class="left">
                    <div class="middle">
                        <img alt="" id="middleImg">
                    </div>
                    <div class="small">
                        <ul>
                        </ul>
                    </div>
                </div>
                <div class="bigger">
                    <img alt=""><br>
                </div>
                <div class="info">
                    <center><h3>购买信息</h3></center>
                    <p><b>商品名称：</b><span id="proName"></span></p>
                    <p><b>商品价格：</b><span id="proPrice"></span></p>
                    <p><b>颜色：</b><span id="proColor"></span></p>
                    <p><b>型号：</b><span id="proType"></span></p>
                    <p><a href="javascript:;" class="btn btn-info" id="addCart">加入购物车</a><a href="buy.html" class="btn btn-info">立即购买</a></p>
                </div>
                <div class="right">
                    <center><h3>商品详情</h3></center>
                    <div id="introduce">

                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="footer-list">
                <div class="footer-service">
                    <ul class="list-service clearfix">
                        <li><a href="#">预约维修服务</a></li>
                        <li><a href="#">7天无理由退货</a></li>
                        <li><a href="#">15天免费换货</a></li>
                        <li><a href="#">满99元包邮</a></li>
                        <li><a href="#">520余家售后网点</a></li>
                    </ul>
                </div>
                <div class="footer-links clearfix">
                    <dl class="col-links col-links-first">
                        <dt>帮助中心</dt>
                        <dd><a href="#">账户管理</a></dd>
                        <dd><a href="#">购物指南</a></dd>
                        <dd><a href="#">订单操作</a></dd>
                    </dl>

                    <dl class="col-links ">
                        <dt>服务支持</dt>
                        <dd><a href="#">售后政策</a></dd>
                        <dd><a href="#">自助服务</a></dd>
                        <dd><a href="#">相关下载</a></dd>
                    </dl>

                    <dl class="col-links ">
                        <dt>线下门店</dt>
                        <dd><a href="#">小米之家</a></dd>
                        <dd><a href="#">服务网点</a></dd>
                        <dd><a href="#">授权体验店</a></dd>
                    </dl>

                    <dl class="col-links ">
                        <dt>关于小米</dt>
                        <dd><a href="#">了解小米</a></dd>
                        <dd><a href="#">加入小米</a></dd>
                        <dd><a href="#">投资者关系</a></dd>
                        <dd><a href="#">廉洁举报</a></dd>
                    </dl>

                    <dl class="col-links ">
                        <dt>关注我们</dt>
                        <dd><a href="#">新浪微博</a></dd>
                        <dd><a href="#" id="J_siteWeixinCode">官方微信</a></dd>
                        <dd><a href="#">联系我们</a></dd>
                        <dd><a href="#">公益基金会</a></dd>
                    </dl>

                    <dl class="col-links ">
                        <dt>特色服务</dt>
                        <dd><a href="#" _blank">F 码通道</a></dd>
                        <dd><a href="#">礼物码</a></dd>
                        <dd><a href="#" _blank">防伪查询</a></dd>
                    </dl>

                    <div class="col-contact">
                        <p class="phone">XXX-XXX-XXXX</p>
                        <p>8:00-18:00（仅收市话费）</p>
                        <p>人工客服:XXXX-XXXXXXXX</p>
                        <div class="follow">关注小米：<a href="#" class="wb"></a><a class="wx" href="#"></a> <img
                                src="pic/wx-img.png">
                        </div>
                    </div>
                </div>
                <hr>
            </div>
            <div class="footer-bn clearfix">
                <div class="logo"></div>
                <div class="info-text">
                    <p class="sites">
                        <a href="#">小米商城</a>
                        <span class="sep">|</span>
                        <a href="#">MIUI</a>
                        <span class="sep">|</span>
                        <a href="#">米家</a>
                        <span class="sep">|</span>
                        <a href="#">米聊</a>
                        <span class="sep">|</span>
                        <a href="#">多看</a>
                        <span class="sep">|</span>
                        <a href="#">游戏</a>
                        <span class="sep">|</span>
                        <a href="#">政企服务</a>
                        <span class="sep">|</span>
                        <a href="#">小米天猫店</a>
                        <span class="sep">|</span>
                        <a href="#">小米集团隐私政策</a>
                        <span class="sep">|</span>
                        <a href="#">小米公司儿童信息保护规则</a>
                        <span class="sep">|</span>
                        <a href="#">小米商城隐私政策</a>
                        <span class="sep">|</span>
                        <a href="#">小米商城用户协议</a>
                        <span class="sep">|</span>
                        <a href="#">问题反馈</a>
                    </p>
                    <br>
                    <p>
                        &copy;
                        <a href="#" title="mi.com">mi.com</a> 京ICP证110507号
                        <a href="#">京ICP备10046444号</a>
                        <a href="#">京公网安备11010802020134号</a>
                        <a href="#">京网文[2020]0276-042号</a>
                        <br>
                        <a href="#">（京）网械平台备字（2018）第00005号</a>
                        <a href="#">互联网药品信息服务资格证 (京)-非经营性-2014-0090</a>
                        <a href="#">营业执照</a>
                        <a href="#">医疗器械质量公告</a>
                        <br>
                        <a href="#">增值电信业务许可证</a>&nbsp;网络食品经营备案（京）【2018】WLSPJYBAHF-12&nbsp;
                        <a href="#">食品经营许可证</a>
                        <br>
                        违法和不良信息举报电话：185-0130-1238&nbsp;<a href='#'>知识产权侵权投诉</a>&nbsp;本网站所列数据，除特殊说明，所有数据均出自我司实验室测试
                    </p>
                </div>
                <div class="info-links clearfix">
                    <a href="#">
                        <img src="pic/truste.png" alt="TRUSTe Privacy Certification">
                    </a>
                    <a href="#">
                        <img src="pic/v-logo-2.png" alt="诚信网站">
                    </a>
                    <a href="#">
                        <img src="pic/v-logo-1.png" alt="可信网站">
                    </a>
                    <a href="#">
                        <img src="pic/ba10428a4f9495ac310fd0b5e0cf8370.png" alt="诚信经营 放心消费">
                    </a>
                </div>
                <div class="slogan"></div>
            </div>
        </div>
    </div>
</body>

<script src="./js/promiseAjax.js"></script>
<script src="./js/jquery-3.4.1.min.js"></script>
<script src="./js/cookie.js"></script>
<script>
    var params = window.location.search;
    var reg = /id=(\d+)/;
    var id = params.match(reg)[1];
    pAjax({
        url:"./server/detail.php",
        type:"post",
        data:{
            id:id
        }
    }).then(function(res){
            var data = res.data;
            $("#middleImg").attr("src",data.imgpath);
            $("#middleImg").attr("src",data.imgpath);
            $("#proName").text(data.name);
            $("#proPrice").text(data.price);
            $("#introduce").html(data.introduce);
            var  lis = data.smallimg.split("====");
            for(var i=0;i<lis.length;i++){
                var li = $("<li><img src='"+lis[i]+"' width='50' height='50'></li>");
                li.css("marginTop","5px");
                $(".small ul").append(li);
            }
            var colors = data.color.split("====");
            var bgcolors = data.bgcolor.split("====");
            for(var i=0;i<colors.length;i++){
                    var $span = $("<span class='btn'>"+colors[i]+"</span>");
                    $span.css("backgroundColor",bgcolors[i]);
                    $span.css("marginLeft","15px");
                    $("#proColor").append($span);
            }
            var types = data.type.split("====");
            for(var i=0;i<types.length;i++){
                var $span = $("<span class='btn'>"+types[i]+"</span>");
                    $span.css("border","1px solid #bdc3c7");
                    $span.css("marginLeft","5px");
                    $("#proType").append($span);
            }
    });

    $("#addCart").click(function(){
        var username = getCookie("username");
        if(!username){
            alert("请先登录");
            location.href="login.html";
            return false;
        }

        var data= localStorage.getItem("data");
        console.log(data);
        if(data){
            data = JSON.parse(data);
            var index = data.findIndex(function(v){
                return v.id == id ;
            });
            if(index>=0){
                data[index].number++;
            }else{
                var obj = {
                    username:username,
                    id:id,
                    number:1
                };
                data.push(obj);
            }
            localStorage.setItem("data",JSON.stringify(data));
        }else{
            var data = [];
            var obj = {
                    username:username,
                    id:id,
                    number:1
            };
            data.push(obj);
            localStorage.setItem("data",JSON.stringify(data));
        }

        return false;
    });

</script>
<script>
    var username = getCookie("username");
    if(username){
        $("#infoSelf").html(username+"用户");
        $(".tpbar-info").css("display","none");
        $(".tpbar-self").css("display","block");
        $("#logout").click(function(){
            removeCookie("username");
            $(".tpbar-info").css("display","block");
            $(".tpbar-self").css("display","none");
        });
    }else{
        $(".tpbar-info").css("display","block");
    }
</script>
</html>